var JSON_URL="../kindeditor/file_manager_json.jsp";var KE=parent.KindEditor;location.href.match(/\?id=([\w-]+)/i);var id=RegExp.$1;var fileManagerJson=(typeof KE.g[id].fileManagerJson=="undefined")?JSON_URL:KE.g[id].fileManagerJson;var lang=KE.lang.plugins.file_manager;KE.event.ready(function(){var e=KE.$("moveupImg",document);var t=KE.$("moveup",document);var q=KE.$("viewType",document);var j=KE.$("orderType",document);var o=KE.$("listTable",document);var r=KE.$("viewTable",document);var f=KE.$("listDiv",document);var l=KE.$("viewDiv",document);e.alt=e.title=lang.moveup;q.options[0]=new Option(lang.viewImage,"VIEW");q.options[1]=new Option(lang.listImage,"LIST");j.options[0]=new Option(lang.fileName,"NAME");j.options[1]=new Option(lang.fileSize,"SIZE");j.options[2]=new Option(lang.fileType,"TYPE");var n=function(u){if(u=="VIEW"){f.style.display="none";l.style.display=""}else{f.style.display="";l.style.display="none"}};var s=function(x){var u=KE.g[id].dialogStack;if(u.length>1){var y=u[u.length-2];var w=KE.util.getIframeDoc(y.iframe);KE.$("url",w).value=x;var v=u[u.length-1];v.hide();return true}else{return false}};var c=function(u,v){if(!s(u)){KE.util.insertHtml(id,'<img src="'+u+'" alt="'+v+'" border="0" />')}};var i=function(u,v){if(!s(u)){KE.util.insertHtml(id,'<a href="'+u+'" target="_blank">'+v+"</a>")}};var m=function(u,v,x){var w=u+" ("+Math.ceil(v/1024)+"KB, "+x+")";return w};var g=function(u,v){if(v.is_dir){u.title=v.filename}else{u.title=m(v.filename,v.filesize,v.datetime)}};var b=function(w,u,x,y){var v=u.current_url+x.filename;v=KE.format.getUrl(v,"absolute");if(x.is_dir){w.onclick=(function(z,A,B){return function(){k(A,j.value,y)}})(v,escape(u.current_dir_path+x.filename+"/"),x.filename)}else{if(x.is_photo){w.onclick=(function(z,A){return function(){c(z,A)}})(v,x.filename)}else{w.onclick=(function(z,A){return function(){i(z,A)}})(v,x.filename)}}};var d=function(u,v){if(u.current_dir_path){t.onclick=function(){k(u.moveup_dir_path,j.value,v)}}else{t.onclick=null}var w=function(){n(q.value);if(q.value=="VIEW"){k(u.current_dir_path,j.value,p)}else{k(u.current_dir_path,j.value,a)}};q.onchange=w;j.onchange=w};var a=function(y){f.innerHTML="";var G=KE.util.parseJson(y);d(G,a);var E=KE.$$("table",document);E.className="file-list-table";E.cellPadding=0;E.cellSpacing=2;E.border=0;f.appendChild(E);var D=G.file_list;for(var w=0,x=D.length;w<x;w++){var v=D[w];var F=E.insertRow(w);F.onmouseover=function(){this.className="selected"};F.onmouseout=function(){this.className="noselected"};var C=F.insertCell(0);C.className="name";var z=v.is_dir?"folder-16.gif":"file-16.gif";var u=KE.$$("img",document);u.src="./images/"+z;u.width=16;u.height=16;u.align="absmiddle";u.alt=v.filename;C.appendChild(u);C.appendChild(document.createTextNode(" "+v.filename));if(!v.is_dir||v.has_file){F.style.cursor="pointer";u.title=v.filename;C.title=v.filename;b(C,G,v,a)}else{u.title=lang.emptyFolder;C.title=lang.emptyFolder}var B=F.insertCell(1);B.className="size";B.innerHTML=v.is_dir?"-":Math.ceil(v.filesize/1024)+"KB";var A=F.insertCell(2);A.className="datetime";A.innerHTML=v.datetime}};var p=function(C){l.innerHTML="";var H=KE.util.parseJson(C);d(H,p);var F=H.file_list;for(var z=0,B=F.length;z<B;z++){var y=F[z];var v=KE.$$("div",document);v.className="file-view-area";l.appendChild(v);var A=KE.util.createTable(document);var G=A.table;G.className="photo noselected";G.onmouseover=function(){this.className="photo selected"};G.onmouseout=function(){this.className="photo noselected"};var D=A.cell;D.valign="middle";D.align="center";var E=H.current_url+y.filename;var u=y.is_dir?"./images/folder-64.gif":(y.is_photo?E:"./images/file-64.gif");var x=KE.$$("img",document);x.src=u;x.width=y.is_dir?64:80;x.height=y.is_dir?64:80;x.alt=y.filename;if(!y.is_dir||y.has_file){G.style.cursor="pointer";g(x,y);g(G,y);b(G,H,y,p)}else{x.title=lang.emptyFolder;G.title=lang.emptyFolder}D.appendChild(x);v.appendChild(G);var w=KE.$$("div",document);w.className="name";w.title=y.filename;w.innerHTML=y.filename;v.appendChild(w)}};var h=function(x,w){KE.util.showLoadingPage(id);var v=window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest();var u=fileManagerJson;u+=x;u+=(u.match(/\?/)?"&":"?")+(new Date()).getTime();v.open("GET",u,true);v.onreadystatechange=function(){if(v.readyState==4){if(v.status==200){w(v.responseText);KE.util.pluginLang("file_manager",document);KE.util.hideLoadingPage(id)}}};v.send(null)};var k=function(w,u,v){h("?path="+w+"&order="+u,v)};n("VIEW");q.value="VIEW";k("",j.value,p)},window,document);